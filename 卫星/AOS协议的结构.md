# 数据通信的CCSDSAOS链路层协议

CCSDS封装由于在空间数据链路协议中传输的数据单元需要有CCSDS授权的包版本号，而封装服务就是提供一种机制使得没有授权包版本号的数据单元能够在空间链路中传输。包长字段用于表示CCSDS封装包的长度。航天器标识由CCSDS分配，用来识别使用该AOS链路帧的航天器。

[空间数据](https://www.chuimin.cn/lilun/1807661.html)系统咨询委员会建议定义了4类[数据链](https://www.chuimin.cn/lilun/1894798.html)路协议：遥测（TM）、遥控（TC）、高级在轨系统（AOS）和邻近空间（Proximity-1）数据链路协议。遥测链路协议通常用于从航天器发送遥测信息到地面站；遥控链路协议通常用于从地面站发送指令到航天器；高级在轨系统链路协议用于高速的上下[通信](https://www.chuimin.cn/lilun/1899903.html)链路，同时双向传输IP数据、话音、视频、实验数据等不同信息；邻近空间链路协议主要用于近距离航天器之间以信息传输为主的通信。

2012年9月，CCSDS发布了“IP OVER CCSDS SPACE LINK”蓝皮书CCSDS 702.1-B建议标准，提出利用AOS链路层协议的封装服务，将IP数据包放入CCSDS封装包中进行传输。IP数据包首先添加一个网络协议扩展（IPE）首部，用于标识IP协议子集；其次添加CCSDS封装包首部，用以标识封装的网络协议型和包[长度](https://www.chuimin.cn/lilun/1366932.html)等信息；最后利用AOS数据链路协议进行传输。当IP数据包长度大于AOS链路帧时，需要对IP数据包进行拆分放到2个以上AOS链路帧中，如图a所示。

![img](https://raw.githubusercontent.com/PeipengWang/picture/master/%E5%8D%AB%E6%98%9F/1f423785-29d8-4fb9-9874-b19d2ec12fd2.jpg)

为充分利用有限的信道资源，当AOS链路帧中已有IP数据包#2且还有足够空间时，可以再放入IP数据包#3，如图（b）所示。

1）IPE封装

​	CCSDS网络协议扩展（IPE）是当上层使用IP协议时，为网络层和数据链路层提供一个可互操作的方法，以此将被CCSDS封装的业务识别为IP数据包。IPE使用一个或多个字节对CCSDS封装包首部进行逻辑扩展，有效地扩展了IP协议类型（IPv4、IPv6、头压缩IPv6等），图中“0x33”表示IPv4协议。

2）CCSDS封装

​	由于在空间数据链路协议中传输的数据[单元](https://www.chuimin.cn/lilun/1649165.html)需要有CCSDS授权的包版本号，而封装服务就是提供一种机制使得没有授权包版本号的数据单元能够在空间链路中传输。CCSDS封装包首部由版本号字段、协议标识字段、包长长度字段、用户自定义字段、协议标识扩展字段、CCSDS定义字段和包长字段组成。版本号字段为“111”。协议标识字段用于表示封装网络协议的类型，“010”表示封装IP协议数据，“110”表示使用协议标识扩展字段识别网络协议类型。包长长度字段用于表示包长字段的字节数。协议标识扩展字段用于扩展封装的网络协议类型。包长字段用于表示CCSDS封装包的长度。用户自定义字段和CCSDS定义字段在封装IP数据包时暂不使用。

1. **版本号**（Version Number）：指示协议的版本，便于处理不同版本的协议帧。
2. **服务类型**（Service Type）：描述帧所携带的数据类型或服务类型。
3. **帧长度**（Frame Length）：定义帧的总长度，便于接收端正确解析和处理帧数据。
4. **时间戳**（Timestamp）：记录帧的发送时间，用于时间同步和延迟计算。
5. **数据序列号**（Data Sequence Number）：唯一标识帧的序列号，确保帧的顺序传输和处理。
6. **校验码**（Checksum）：用于校验帧数据的完整性，确保数据在传输过程中没有被篡改。

作用

- **控制和管理数据流**：IPE头包含的信息用于控制和管理数据流，确保数据的有序和可靠传输。
- **时间同步**：通过时间戳字段，IPE头可以帮助实现发送端和接收端的时间同步。
- **错误检测和纠正**：校验码字段用于检测和纠正传输过程中的数据错误，确保数据的完整性和可靠性。

AOS链路帧结构

AOS数据链路帧结构如图所示，链路帧的长度可变（由同步和信道的编码方式确定），图所示的AOS链路帧长度为1 115 B，由AOS帧首部、数据字段、[差错控制](https://www.chuimin.cn/lilun/1395208.html)字段组成。

![img](https://raw.githubusercontent.com/PeipengWang/picture/master/%E5%8D%AB%E6%98%9F/3e8dccfb-87f7-4580-b6a1-f0a0c4f6defd.jpg)

AOS帧首部

AOS帧首部由主通道标识（含版本号和航天器标识）、虚通道标识、虚通道帧计数、信令字段（含重放标识、帧计数循环使用标识、保留和帧计数循环）组成。AOS链路帧版本号为“01”。航天器标识由CCSDS分配，用来识别使用该AOS链路帧的航天器。虚通道标识用来标识上层协议数据单元所使用的虚拟信道。虚通道帧计数为每条虚拟通道上的链路帧顺序编号。重放标识用于区分实时数据（置0）或回放数据（置1）。帧计数循环使用标识表示是否使用了帧计数循环字段。保留字段填充全零。帧计数循环字段当虚通道帧计数归零时加1。

2）数据字段

AOS帧数据字段由复用协议数据单元（M＿PDU）首部和数据两部分组成。M＿PDU首部的保留字段填充全零；第一包[指针](https://www.chuimin.cn/lilun/1304324.html)指向M＿PDU数据中第一个CCSDS包首部的位置。若M＿PDU数据字段中不存在一个完整包的起始部分，第一包指针置“1”。M＿PDU数据字段的长度是固定的（1105B），包含CCSDS包。

3）差错控制字段

差错控制字段用以保护整个AOS链路帧。

