# **Kubernetes Pod è¯¦è§£**

åœ¨ Kubernetes (K8s) ä¸­ï¼Œ**Pod æ˜¯æœ€å°çš„å¯éƒ¨ç½²å•å…ƒ**ï¼Œå®ƒå°è£…äº†ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œä»¥åŠå­˜å‚¨ã€ç½‘ç»œç­‰èµ„æºã€‚Pod å…è®¸å¤šä¸ªå®¹å™¨å…±äº«å­˜å‚¨å’Œç½‘ç»œï¼Œå®ç°é«˜æ•ˆçš„åˆ†å¸ƒå¼åº”ç”¨éƒ¨ç½²ã€‚

------

## **ğŸ“Œ 1. Pod çš„æ ¸å¿ƒæ¦‚å¿µ**

### **ğŸ”¹ 1.1 ä»€ä¹ˆæ˜¯ Podï¼Ÿ**

- Pod æ˜¯ K8s çš„åŸºæœ¬è°ƒåº¦å•ä½ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨
- **å¤šä¸ªå®¹å™¨å…±äº«ç›¸åŒçš„å­˜å‚¨å·ã€ç½‘ç»œå’Œç”Ÿå‘½å‘¨æœŸ**
- Pod è¿è¡Œåœ¨ **Node èŠ‚ç‚¹ä¸Š**ï¼Œé€šè¿‡ K8s è°ƒåº¦ç®¡ç†

### **ğŸ”¹ 1.2 Pod çš„ç‰¹ç‚¹**

- **å¯ä»¥è¿è¡Œå•ä¸ªæˆ–å¤šä¸ªå®¹å™¨**
- **å…±äº«ç½‘ç»œï¼ˆIPã€ç«¯å£ï¼‰**
- **å…±äº«å­˜å‚¨ï¼ˆVolumesï¼‰**
- **ç”Ÿå‘½å‘¨æœŸå— K8s æ§åˆ¶**

------

## **ğŸ“Œ 2. Pod çš„ç»“æ„**

Pod ä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

| **ç»„ä»¶**               | **ä½œç”¨**                              |
| ---------------------- | ------------------------------------- |
| **Pod Spec**           | å®šä¹‰ Pod çš„é…ç½®ï¼Œå¦‚å®¹å™¨ã€å­˜å‚¨ã€ç½‘ç»œç­‰ |
| **Containers**         | Pod å†…éƒ¨è¿è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨          |
| **Volume**             | å­˜å‚¨æŒ‚è½½ï¼Œç”¨äºæ•°æ®å…±äº«                |
| **Networking**         | Pod å…±äº«åŒä¸€ IP åœ°å€                  |
| **Labels & Selectors** | ç”¨äºæ ‡è¯†å’Œè°ƒåº¦ Pod                    |

### **ğŸ“Œ 2.1 Pod YAML ç»“æ„ç¤ºä¾‹**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  labels:
    app: my-app
spec:
  containers:
  - name: my-container
    image: nginx:latest
    ports:
    - containerPort: 80
  restartPolicy: Always
```

**è§£æï¼š**

- `metadata`ï¼šå®šä¹‰ Pod åç§°å’Œæ ‡ç­¾
- `spec`ï¼šæŒ‡å®š Pod è¿è¡Œçš„ **å®¹å™¨**ã€ç«¯å£ã€é‡å¯ç­–ç•¥ç­‰
- `containers`ï¼šå®šä¹‰å®¹å™¨çš„ `name` å’Œ `image`
- `restartPolicy`ï¼šè®¾ç½® Pod å¤±è´¥åçš„é‡å¯ç­–ç•¥

------

## **ğŸ“Œ 3. Pod çš„ç±»å‹**

### **ğŸ”¹ 3.1 æ™®é€š Podï¼ˆStandalone Podï¼‰**

- ç›´æ¥åˆ›å»ºçš„ Podï¼Œä¸å— K8s é¢å¤–ç®¡ç†
- é€‚ç”¨äºä¸´æ—¶ä»»åŠ¡ï¼Œä½†ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

```sh
kubectl apply -f pod.yaml
kubectl get pods
```

### **ğŸ”¹ 3.2 é€šè¿‡ Controller ç®¡ç†çš„ Pod**

| **Pod ç±»å‹**      | **æè¿°**                                 |
| ----------------- | ---------------------------------------- |
| **Deployment**    | é€‚ç”¨äºæ— çŠ¶æ€åº”ç”¨ï¼Œæ”¯æŒæ»šåŠ¨æ›´æ–°           |
| **StatefulSet**   | é€‚ç”¨äºæœ‰çŠ¶æ€åº”ç”¨ï¼ˆæ•°æ®åº“ç­‰ï¼‰             |
| **DaemonSet**     | åœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œä¸€ä¸ª Podï¼ˆå¦‚æ—¥å¿—é‡‡é›†ï¼‰ |
| **Job / CronJob** | è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡æˆ–å®šæ—¶ä»»åŠ¡                 |

#### **ğŸ”¸ Deployment ç¤ºä¾‹**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
```

- **replicas: 3** è¡¨ç¤ºåˆ›å»º 3 ä¸ªç›¸åŒçš„ Pod
- Deployment è´Ÿè´£ **è‡ªåŠ¨é‡å¯ã€æ‰©ç¼©å®¹å’Œæ»šåŠ¨æ›´æ–°**

------

## **ğŸ“Œ 4. Pod çš„ç½‘ç»œ**

### **ğŸ”¹ 4.1 Pod çš„ç½‘ç»œç‰¹ç‚¹**

- **æ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ IP**
- **åŒä¸€ä¸ª Pod å†…çš„å®¹å™¨å…±äº« IP**
- **Pod ä¹‹é—´é€šè¿‡ Cluster å†…éƒ¨ç½‘ç»œé€šä¿¡**
- **éœ€è¦ Service è¿›è¡Œå¤–éƒ¨è®¿é—®**

### **ğŸ”¹ 4.2 Pod è®¿é—®æ–¹å¼**

| **æ–¹å¼**          | **è¯´æ˜**                            |
| ----------------- | ----------------------------------- |
| **åŒä¸€ä¸ª Pod å†…** | ç›´æ¥ `localhost:ç«¯å£å·` è®¿é—®        |
| **ä¸åŒ Pod ä¹‹é—´** | ä½¿ç”¨ `Pod IP` è®¿é—®                  |
| **è·¨ Node è®¿é—®**  | é€šè¿‡ `ClusterIP Service` è®¿é—®       |
| **å¤–éƒ¨è®¿é—®**      | é€šè¿‡ `NodePort / LoadBalancer` è®¿é—® |

#### **ğŸ”¸ Pod ä¹‹é—´é€šä¿¡**

```sh
# è·å– Pod çš„ IP
kubectl get pod -o wide
# è¿›å…¥ Pod è®¿é—®å¦ä¸€ä¸ª Pod
kubectl exec -it my-pod -- curl <ç›®æ ‡-Pod-IP>:80
```

#### **ğŸ”¸ é€šè¿‡ Service è®¿é—®**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
```

- é€šè¿‡ `my-service` è®¿é—® `app=my-app` çš„ Pod

------

## **ğŸ“Œ 5. Pod çš„å­˜å‚¨**

### **ğŸ”¹ 5.1 Volume ä»‹ç»**

K8s æä¾› **æŒä¹…åŒ–å­˜å‚¨ Volume**ï¼Œå¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«æ•°æ®ã€‚

| **å­˜å‚¨ç±»å‹**              | **è¯´æ˜**                             |
| ------------------------- | ------------------------------------ |
| **emptyDir**              | Pod è¿è¡Œæ—¶çš„ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åä¸¢å¤± |
| **hostPath**              | ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºæ–‡ä»¶                   |
| **PersistentVolume (PV)** | ç»‘å®šå¤–éƒ¨å­˜å‚¨                         |
| **ConfigMap / Secret**    | ç”¨äºå­˜å‚¨é…ç½®æ•°æ®                     |

### **ğŸ”¹ 5.2 Volume ç¤ºä¾‹**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: volume-pod
spec:
  containers:
  - name: nginx
    image: nginx
    volumeMounts:
    - mountPath: /usr/share/nginx/html
      name: my-volume
  volumes:
  - name: my-volume
    emptyDir: {}
```

- `emptyDir` ç”¨äºä¸´æ—¶å­˜å‚¨ï¼ŒPod ç»ˆæ­¢æ—¶æ•°æ®ä¸¢å¤±

------

## **ğŸ“Œ 6. Pod çš„ç”Ÿå‘½å‘¨æœŸ**

Pod ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹çŠ¶æ€ï¼š

| **çŠ¶æ€**      | **è¯´æ˜**                         |
| ------------- | -------------------------------- |
| **Pending**   | Pod åˆ›å»ºä¸­ï¼Œæœªè°ƒåº¦åˆ° Node        |
| **Running**   | Pod è¿è¡Œä¸­ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨åœ¨è¿è¡Œ |
| **Succeeded** | Pod ä»»åŠ¡å®Œæˆï¼Œå®¹å™¨é€€å‡º           |
| **Failed**    | Pod è¿è¡Œå¤±è´¥                     |
| **Unknown**   | Pod çŠ¶æ€æœªçŸ¥                     |

### **ğŸ”¹ 6.1 Pod ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```sh
# æŸ¥çœ‹ Pod çŠ¶æ€
kubectl get pods
kubectl describe pod my-pod

# åˆ é™¤ Pod
kubectl delete pod my-pod
```

------

## **ğŸ“Œ 7. Pod çš„é‡å¯ç­–ç•¥**

Pod çš„ `restartPolicy` å½±å“å…¶é‡å¯æ–¹å¼ï¼š

| **ç­–ç•¥**      | **æè¿°**           |
| ------------- | ------------------ |
| **Always**    | æ€»æ˜¯é‡å¯ï¼ˆé»˜è®¤å€¼ï¼‰ |
| **OnFailure** | å¤±è´¥æ—¶é‡å¯         |
| **Never**     | å¤±è´¥åä¸é‡å¯       |

ç¤ºä¾‹ï¼š

```yaml
restartPolicy: Always
```

------

## **ğŸ“Œ 8. Pod è°ƒåº¦**

Pod è°ƒåº¦å†³å®šå…¶åœ¨å“ªä¸ª Node ä¸Šè¿è¡Œï¼Œä¸»è¦å— **èµ„æºã€æ ‡ç­¾ã€Taints/Tolerations å½±å“**ã€‚

| **è°ƒåº¦æ–¹å¼**                 | **æè¿°**                        |
| ---------------------------- | ------------------------------- |
| **NodeSelector**             | é€‰æ‹©ç‰¹å®šçš„ Node                 |
| **Affinity / Anti-Affinity** | é«˜çº§è°ƒåº¦ç­–ç•¥                    |
| **Taints / Tolerations**     | å…è®¸ç‰¹å®š Pod è¿è¡Œåœ¨ç‰¹æ®Š Node ä¸Š |

### **ğŸ”¹ NodeSelector ç¤ºä¾‹**

```yaml
spec:
  nodeSelector:
    disktype: ssd
```

- è¯¥ Pod åªèƒ½è¿è¡Œåœ¨ `disktype=ssd` çš„ Node ä¸Š

------

# **ğŸ¯ æ€»ç»“**

- **Pod æ˜¯ K8s çš„æœ€å°éƒ¨ç½²å•å…ƒ**
- **Pod å†…éƒ¨å®¹å™¨å…±äº«ç½‘ç»œå’Œå­˜å‚¨**
- **Pod é€šè¿‡ Service è¿›è¡Œè®¿é—®**
- **Pod å— Deployment / StatefulSet ç®¡ç†**
- **Pod æœ‰å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸå’Œé‡å¯ç­–ç•¥**
- **Pod é€šè¿‡è°ƒåº¦ç­–ç•¥æ§åˆ¶è¿è¡Œåœ¨å“ªä¸ª Node ä¸Š**

ğŸš€ **ç†è§£ Pod æ˜¯æŒæ¡ K8s çš„å…³é”®ï¼**