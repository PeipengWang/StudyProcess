







​        2023年8月，我参与了公司的“网管资源统一管理平台”项目。公司主营通信设备，设备中运行着复杂的软硬件系统。本项目的主要目标是对各种资源设备上的软硬件系统进行统一管理，特别是对设备的硬件信息进行实时监控，并统一处理不同业务的性能数据。运维人员是本项目的主要使用角色，通过对软硬件的自定义指标和性能数据结合，进行设备告警和权限管理。在该项目中，我担任了架构师角色，全面负责项目的架构设计。通过采用微服务架构，项目的各个功能模块被拆分为独立的服务，这样不仅提高了系统的灵活性，还促进了各服务的独立扩展和维护。微服务架构能够将系统的不同部分解耦，使得每个模块的开发、测试、部署和升级更加高效。此外，微服务还支持分布式部署，在系统规模不断扩展时能保持较高的性能和可用性，满足了项目对高并发、高可靠性的要求。经过合理的设计，本项目成功上线，获得领导和用户的一致好评

​	公司之前维护一套单体架构的系统，但随着公司通信业务的发展，尤其是5G业务的快速应用到市场，单体架构的部署方式复杂、耦合性高，单体故障、维护困难等问题越来越凸显，越来越难以支持公司的多样化需求。因此，为完善通过软件对硬件的统一管理，公司领导决定针对原有代码进行架构重构，我作为项目负责人，与各领域团队成员决定采用微服务架构来对代码进行重构与拆分。微服务架构是一种将单一应用程序拆分为一组小的服务的架构，具备高度可移植性、可独立部署、可独立开发等优势，同时可根据不同服务特点进行不同策略的弹性扩展，包括负载均衡。业务独立拆分能够完美的解决当前问题，接下来我将会从在功能上的服务拆分，针对本软件的各种通信方式进行服务拆分，通过集群化部署方式来进行实现自适应扩容缩容等方面来论述微服务架构的特点及其在本项目中的应用。

   **服务拆分**

​	首先，单体架构的服务拆分方法有很多种，包括领域驱动开发模型、基于功能的拆分，基于数据的拆分，基于通信方式的拆分，通过对软件系统进行分析，在不同的客户群体，对于本系统的侧重点不同，因此可能对于本系统的利用方面也不同，例如对于银行客户群体，更多关注设备当前性能数据的状态，而不需要告警信息。因此本系统决定以功能方式对模块拆分，对模块拆分过程中主要通过三个层次进行拆分，首先对于表示层，通过微前端方式，利用当前的乾坤框架对前端进行拆分。对于后端代码，首先对公共依赖的代码组件进行抽象，然后每个模块能够独立运行，最后对于数据库进行分库分表的形式划分不同表空间，完成模块的拆分。项目每个微服务采用分层架构方式，分别拆分为资源管理软件、性能管理软件、告警管理软件、权限管理软甲、服务注册管理软件、日志管理软件等。

   **服务通信**

在本项目中，服务需要完成服务之间的内部通信。服务与服务之间包括接口调用和数据交换，对于接口调用改变为服务注册与服务发现形式，通过Nacos作为注册中心，通过Feign作为服务调用工具完成服务注册与服务调用。对于服务之间的数据交换，项目决定引入kafka作为数据中心，通过消息队列完成数据的异步通信。针对外部通信，主要是不同设备进行不同协议方式通信来被动和主动获取数据，各个模块都有不同的通信方式，例如，通过SNMP协议获取设备上的硬件信息，通过TCP协议与运行在不同嵌入式设备上的软件进行通信，通过提供Rest接口被动接收设备传来的信息 。项目中虽然有不同的协议，但是不同的协议处理后的数据格式是一致的，因此，规划出一个协

​    **集群化与部署**

同时，为了保证微服务的可靠性、可用性、高性能、安全性，项目决定对微服务进行集群化管理，通过docker容器进行部署。

**高可靠性**指的是系统在长时间内，尤其是在发生故障的情况下，能够保持服务不间断运行的能力，针对项目单体架构单点故障的问题，项目决定进行集群化改造，主要包括、将会话进行和内部缓存数据移出，进行分布式缓存管理，对分布式事务、分布式锁等进行统一管理‘。搭建引入的公共组件，包括redis、kafka、mysql等进行集群化管理。

**高可靠性**指的是一个系统在预定的时间内，能够持续稳定地提供服务的能力，尤其是在发生故障时能迅速恢复，最小化停机时间。针对此问题，对每个微服务进行心跳管理，提供一个心跳接口，间断性的对服务进行探测，探测失败则进行重启。

同时为了保证安全性，通过服务网关进行权限管理。

除了上述基本的微服务改造之外，针对每个微服务都有自己的独立日志，出现问题不方便排查问题，项目引入ELK作为日志监控组件。

为了保证服务开发的质量和快速交付，项目同时利用Jekins+Gerrit引入了CI/CD流程，通过漏洞扫描、复杂度检查、单元测试覆盖率检查等措施对代码进行审查，使各个微服务快速迭代管理。



通过以上设计，经过8个月时间的努力，项目成功的完成了对于单体架构项目的微服务集群化改造，随后陆续有部分项目逐渐重新引用新的系统，项目取得了成功，获得客户、领导的一致好评。当然在系统微服务设计过程中，由于时间紧的缘故，服务部署方式还需要进一步完善，下一步准备采用k8s作为服务部署与集群管理方式。同时，



